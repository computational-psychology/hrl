# Deploying your code in the lab

This page explain the steps needed to deploy your experiment in 
a machine where the actual experiments will be carried out.
This machine is normally in a vision laboratory, it has specific hardware
that allows high resolution luminance, and it has a monitor has been
*previously calibrated*.


## Install libraries required for high-resolution luminance

Ensure that the libraries required for high-resolution luminace are
installed. See the [installation page](install-inlab) for details.


## Have a calibration file 

Ensure that you have a calibration file `lut.csv`.
This file is the result of the calibration process,
in which we measure the luminance (in $cdm^{-2}$) that
the monitor emits for input values between `0.0` and `1.0` 
(the values in the numpy array).

The `lut.csv` file has three columns and looks something like the table 
above. The file needs to be generated by `HRL` 
(see the [calibration documentation](../calibration/gamma-correction-linearization) for instructions.)


| IntensityIn |  IntensityOut | Luminance ($cdm^{-2}$) |
| ----------- | ------------- | ---------------------- |
| 0.0         | 0.0           | 0.0034                 |
| 0.00024     | 0.05490       | 0.1334                 |
 ...
| 0.98485     | 0.99607       | 498.88                 |
| 0.99413     | 1.0           | 501.90                 |



## Change HRL parameters

When initializing HRL, you used `graphics="gpu"` and `inputs="keyboard`.
These are the default values and the script will run in any machine. 
To run the same experiment in the lab, you need to change the `graphics`
and `input` parameters as follows: 

- `graphics`:
	- `graphics="datapixx"` (for the Datapixx 1 device), or
	- `graphics="viewpixx"` (for the Viewpixx 3D device).

- `input`:
    - change to `inputs="responsepixx"` to use the ResponsePixx button board.
    
You also need to

- add `lut=lut.csv` as an input parameter (the default is `None`). 
  As mentioneed above this file needs to be created
  with HRL during calibration. See the 
  [calibration documentation](../calibration/gamma-correction-linearization) for 
  instructions.

- eventually change the parameter `scr` to match the experimental display.

- eventually adjust the window resolution (parameters `wdth` and `hght`),


With all these changes the experiment should be now running in the experimental
monitor. 

```{note}
Note that HRL uses the `lut.csv` file to **linearize** the monitor, that is,
to have a linear relationship from the numpy array value (in the range 0 to 1)
to the emitted luminance, which is not how monitors normally work.
Thus, it is completely normal that the stimuli will look different in the 
monitor than in your machine. 
```

```{note}
If you need to define your stimuli in luminance units, then
you need to use the `lut.csv` file to find the input value for your
desired luminance. 

(TODO) We provide an example script that help you do that.
```



 
