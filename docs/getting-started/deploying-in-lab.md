# Deploying your code in the lab

This page explain the steps needed to deploy your experiment in 
a machine where the actual experiments will be carried out.
This machine is normally in a vision laboratory, it has specific hardware
that allows high resolution luminance, and it has a monitor has been
*previously calibrated*.


## Install libraries required for high-resolution luminance

Ensure that the libraries required for high-resolution luminace are
installed. See the [installation page](install-inlab) for details.


## Have a calibration file 

Ensure that you have a calibration file `lut.csv`.
This file is the result of the calibration process,
in which we measure the luminance (in $cdm^{-2}$) that
the monitor emits for input values between `0.0` and `1.0` 
(the values in the numpy array).

The `lut.csv` file has three columns and looks something like the table 
above. The file needs to be generated by `HRL` 
(see the [calibration documentation](../calibration/gamma-correction-linearization) for instructions.)


| IntensityIn |  IntensityOut | Luminance ($cdm^{-2}$) |
| ----------- | ------------- | ---------------------- |
| 0.0         | 0.0           | 0.0034                 |
| 0.00024     | 0.05490       | 0.1334                 |
 ...
| 0.98485     | 0.99607       | 498.88                 |
| 0.99413     | 1.0           | 501.90                 |


```{important}
HRL will use this file (`lut.csv`) to **linearize** the monitor, that is,
to have a linear relationship between the numpy array value (in the range 0 to 1)
and the emitted luminance by the monitor.
This mapping is determined by the *first* and *third* columns of the file. 
```



## Change HRL parameters

When initializing HRL, you used `graphics="gpu"` and `inputs="keyboard`.
These are the default values and so `HRL` will run in any machine. 

To run the same experiment in the lab, you need to change the `graphics`
and `input` parameters as follows: 

- `graphics`:
	- `graphics="datapixx"` (for the Datapixx 1 device)
	- `graphics="viewpixx"` (for the Viewpixx 3D device).

- `input`:
    - `inputs="responsepixx"` to use the ResponsePixx button board.
    
You also need to

- add `lut='lut.csv'` as an input parameter (the default is `None`). 
  As mentioned above this file needs to be created
  with HRL during [calibration](../calibration/gamma-correction-linearization).

- change the parameter `scr` to match the experimental display (in the 
  case of multiple monitors. Normally it is either 0, 1 or 2.)

- adjust the window resolution (parameters `wdth` and `hght`) to match
  the resolution of the experimental monitor.
  
- set `fs` to `True` for fullscreen presentation


With all these changes the experiment should be now running in the experimental
monitor. 



```{note}
The mapping between input value and luminance in normal monitors is 
*not* linear.
Thus, it is completely normal 
that the stimuli will look different in the 
monitor than in your laptop. 

If you need to define your stimuli in luminance units,
then you need to go back to your stimulus generation code and 
calculate which input value (first column in `lut.csv`) you
need to set for a desired luminance (third column in `lut.csv`)

(TODO) We provide an example script that help you do that (link)

```

## Done



 
